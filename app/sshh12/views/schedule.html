<script src="sshh12#general"></script>
<script src="sshh12#lang"></script>

<div class="">
  <super-navbar>
    <super-navbar-title style="text-align: center;">Schedules</super-navbar-title>
    <super-navbar-button side="left" onclick="supersonic.ui.modal.hide();">Back</super-navbar-button>
    <super-navbar-button side="right" onclick="updateList('a');">Refresh</super-navbar-button>
  </super-navbar>
  <ul class="list" id="items">
    <label class="item item-input item-select">
      <div class="input-label">Lunch</div>
      <select id="lunch" style="width: 100%;" onChange="updateList('a');">
        <option value="none">Select Your Lunch</option>
        <option value="a">A</option>
        <option value="b">B</option>
        <option value="c">C</option>
      </select>
    </label>
  </ul>
</div>
<script>
function timeslot(timestring, name){
    this.rawstring = timestring;

    this.rawname = name;

    var split = timestring.split("-");
    this.start_time = split[0];
    this.end_time = split[1];

    var date_now = new Date();

    var start_split = this.start_time.split(":");
    this.start_date = new Date(date_now.valueOf());
    this.start_date.setHours(start_split[0]);
    this.start_date.setMinutes(start_split[1]);
    this.start_date.setSeconds(0);

    var end_split = this.end_time.split(":");
    this.end_date = new Date(date_now.valueOf());
    this.end_date.setHours(end_split[0]);
    this.end_date.setMinutes(end_split[1]);
    this.end_date.setSeconds(0);

    this.getNameString = function(){
      var s = "";
      if(this.start_date.getHours() > 12){
        s += this.start_date.getHours() - 12;
      } else {
        s += this.start_date.getHours();
      }
      s += ":" + this.start_date.getUTCMinutes() + "-";

      if(this.end_date.getHours() > 12){
        s += this.end_date.getHours() - 12;
      } else {
        s += this.end_date.getHours();
      }
      s += ":" + this.end_date.getUTCMinutes();

      return s;
    };

    this.contains = function(other_date){
      return other_date.getTime() > this.start_date.getTime() && this.end_date.getTime() > other_date.getTime();
    };

    this.getTimeLeft = function(other_date){
      if(!this.contains(other_date)){
        return -1;
      } else {
        return Math.round((this.end_date.getTime() - other_date.getTime()) / (60 * 1000));
      }
    };

    this.toStringFormat = function(c_date){
      if(this.contains(c_date)){
        return "<div class=\"item\"><b>" + this.rawname + "</b> - " + this.getNameString() + ", <b>" + this.getTimeLeft(c_date) + " mins</b> left</div>";
      } else {
        return "<div class=\"item\"><b>" + this.rawname + "</b> - " + this.getNameString() + "</div>";
      }
    };
}

var ScheduleTitles = {
  "a": "A, Regular",
  "b": "B, Extended 2nd Period",
  "c": "C, Pep Rally"
};

var ASchedule = [[
    new timeslot("7:25-8:16", "1st"),
    new timeslot("8:22-9:15", "2nd"),
    new timeslot("9:21-10:12", "3rd"),
    new timeslot("12:42-13:33", "6th"),
    new timeslot("13:45-14:30", "7th"),
    new timeslot("14:45-15:10", "Tutorials")
  ],
  {
    "none": [new timeslot("10:18-12:36", "4th, 5th, Lunch")],
    "a": [
      new timeslot("10:12-10:42", "A Lunch"),
      new timeslot("10:48-11:39", "4th"),
      new timeslot("11:45-12:36", "5th")
    ],
    "b": [
      new timeslot("10:18-11:09", "4th"),
      new timeslot("11:09-11:39", "B Lunch"),
      new timeslot("11:45-12:36", "5th")
    ],
    "c": [
      new timeslot("10:18-11:09", "4th"),
      new timeslot("11:15-12:06", "5th"),
      new timeslot("12:06-12:36", "C Lunch")
    ]
  }
];

var BSchedule = [[
    new timeslot("7:25-8:16", "1st"),
    new timeslot("8:22-9:15", "2nd"),
    new timeslot("9:21-10:12", "3rd"),
    new timeslot("12:42-13:33", "6th"),
    new timeslot("13:45-14:30", "7th"),
    new timeslot("14:45-15:10", "Tutorials")
  ],
  {
    "none": [new timeslot("10:18-12:36", "4th, 5th, Lunch")],
    "a": [
      new timeslot("10:12-10:42", "A Lunch"),
      new timeslot("10:48-11:39", "4th"),
      new timeslot("11:45-12:36", "5th")
    ],
    "b": [
      new timeslot("10:18-11:09", "4th"),
      new timeslot("11:09-11:39", "B Lunch"),
      new timeslot("11:45-12:36", "5th")
    ],
    "c": [
      new timeslot("10:18-11:09", "4th"),
      new timeslot("11:15-12:06", "5th"),
      new timeslot("12:06-12:36", "C Lunch")
    ]
  }
];

var CSchedule = [[
    new timeslot("7:25-8:16", "1st"),
    new timeslot("8:22-9:15", "2nd"),
    new timeslot("9:21-10:12", "3rd"),
    new timeslot("12:42-13:33", "6th"),
    new timeslot("13:45-14:30", "7th"),
    new timeslot("14:45-15:10", "Tutorials")
  ],
  {
    "none": [new timeslot("10:18-12:36", "4th, 5th, Lunch")],
    "a": [
      new timeslot("10:12-10:42", "A Lunch"),
      new timeslot("10:48-11:39", "4th"),
      new timeslot("11:45-12:36", "5th")
    ],
    "b": [
      new timeslot("10:18-11:09", "4th"),
      new timeslot("11:09-11:39", "B Lunch"),
      new timeslot("11:45-12:36", "5th")
    ],
    "c": [
      new timeslot("10:18-11:09", "4th"),
      new timeslot("11:15-12:06", "5th"),
      new timeslot("12:06-12:36", "C Lunch")
    ]
  }
];

function makeSelect(option, sched){
  var html = "<label class=\"item item-input item-select\"><div class=\"input-label\">Lunch</div><select id=\"lunch\" style=\"width: 100%;\" onChange=\"updateList('a');\"><option value=\"none\" ";
  var sel_html = "selected=\"selected\"";
  if(option == "none"){
    html += sel_html;
  }
  html += ">Select Your Lunch</option><option value=\"a\" ";
  if(option == "a"){
    html += sel_html;
  }
  html += ">A</option><option value=\"b\" ";
  if(option == "b"){
    html += sel_html;
  }
  html += ">B</option><option value=\"c\" ";
  if(option == "c"){
    html += sel_html;
  }
  html += ">C</option></select></label>";
  return html;
}

function updateList(sched){
  var lunch_letter = document.getElementById("lunch").value;

  document.getElementById("items").innerHTML = makeSelect(lunch_letter, sched);

  var date_now = new Date();

  var html = makeSelect(lunch_letter, sched);

  html += "<div class=\"item item-divider\">" + ScheduleTitles[sched] + "</div>";

  var lunch_added = false;
  var lunch_timeslots = null;
  var MainSched = null;
  if(sched == 'b'){
    lunch_timeslots = BSchedule[1][lunch_letter];
    MainSched = BSchedule[0];
  } else if(sched == 'c'){
    lunch_timeslots = CSchedule[1][lunch_letter];
    MainSched = CSchedule[0];
  } else {
    lunch_timeslots = ASchedule[1][lunch_letter];
    MainSched = ASchedule[0];
  }

  for(var i = 0; i < MainSched.length; i++){
    if(!lunch_added && i < MainSched.length-1 && MainSched[i].start_date.getTime() > lunch_timeslots[lunch_timeslots.length-1].end_date.getTime()){
      for(var k = 0; k < lunch_timeslots.length; k++){
        html += lunch_timeslots[k].toStringFormat(date_now);
      }
      lunch_added = true;
    }
    html += MainSched[i].toStringFormat(date_now);
  }
  document.getElementById("items").innerHTML = html;
}

updateList('a');
</script>
